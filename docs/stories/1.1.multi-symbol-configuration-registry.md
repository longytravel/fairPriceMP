# Story 1.1: Multi-Symbol Configuration Registry

## Status
Draft

## Story
**As a** trader,
**I want** to configure up to 28 symbols with global defaults and per-symbol overrides,
**so that** I can manage the entire portfolio from one EA without code edits.

## Acceptance Criteria
1. EA inputs expose symbol list management, global defaults, and per-symbol override slots (grid, risk, correlation, dashboard settings).
2. Duplicate or unsupported symbols are rejected with descriptive errors before trading starts.
3. On init, the EA auto-subscribes required symbols or timeframes and reports readiness per symbol in the log or dashboard.
4. Configuration data is stored in a structure accessible to downstream modules (risk, correlation, UI) without direct coupling.

## Tasks / Subtasks
- [ ] Implement configuration loader support for global defaults and per-symbol overrides (AC: 1,4) [Source: architecture-fullstack/components.md#configuration-loader]
  - [ ] Extend `ConfigDto` to emit `SymbolConfigEntry[]` records including overrides and dashboard styles (AC: 1) [Source: architecture-fullstack/data-models.md#symbolconfigentry]
  - [ ] Persist parsed entries into `SymbolStateRegistry` so downstream modules can consume configuration snapshots (AC: 4) [Source: architecture-fullstack/tech-stack.md#tech-stack]
- [ ] Enforce symbol validation and duplicate rejection prior to engine start (AC: 2) [Source: architecture-fullstack/security-and-performance.md#security-and-performance]
  - [ ] Leverage `ConfigValidator::ValidateSymbolList` to detect unsupported or duplicate symbols and emit structured error logs (AC: 2) [Source: architecture-fullstack/components.md#configuration-loader]
  - [ ] Surface validation failures to the orchestrator and halt init via `StructuredLogger` event codes (AC: 2) [Source: architecture-fullstack/components.md#orchestrator-core]
- [ ] Auto-subscribe symbols and announce readiness during `OnInit` (AC: 3) [Source: architecture-fullstack/core-workflows.md#core-workflows]
  - [ ] Use orchestrator boot sequence to request market data subscriptions for each enabled symbol (AC: 3) [Source: architecture-fullstack/components.md#orchestrator-core]
  - [ ] Emit per-symbol readiness entries through `StructuredLogger` and dashboard renderer hooks (AC: 3) [Source: architecture-fullstack/components.md#dashboard-renderer]
- [ ] Share configuration DTOs with engines, correlation service, and dashboard renderer (AC: 4) [Source: architecture-fullstack/components.md#symbol-engine]
  - [ ] Wire orchestrator hand-offs so engines and services receive immutable configuration references (AC: 4) [Source: architecture-fullstack/high-level-architecture.md#high-level-architecture]
  - [ ] Document DTO access patterns in module headers to avoid tight coupling between services (AC: 4) [Source: architecture-fullstack/high-level-architecture.md#high-level-architecture]
- [ ] Add validation and regression tests for multi-symbol configuration handling (AC: 1-4) [Source: architecture-fullstack/testing-strategy.md#testing-strategy]
  - [ ] Implement backend unit tests covering symbol list parsing, duplicate rejection, and DTO propagation (AC: 1,2,4) [Source: architecture-fullstack/testing-strategy.md#testing-strategy]
  - [ ] Schedule multi-symbol MT5 strategy tester run to confirm readiness logging and snapshot outputs (AC: 3) [Source: architecture-fullstack/testing-strategy.md#testing-strategy]

## Dev Notes
### Previous Story Insights
No specific guidance found in architecture docs.

### Data Models
- `SymbolConfigEntry` stores each symbol's enable flag, per-symbol overrides, and dashboard style settings that must be exposed via configuration inputs. [Source: architecture-fullstack/data-models.md#symbolconfigentry]
- `SymbolRuntimeState` maintains live telemetry (signal state, drawdown, blocked status) and should be seeded from configuration during init. [Source: architecture-fullstack/data-models.md#symbolruntimestate]

### API Specifications
- `ConfigLoader` exposes `LoadConfig(string fileName)` and `ValidateSymbolList(string symbols[])` for parsing inputs and rejecting invalid symbol definitions. [Source: architecture-fullstack/components.md#configuration-loader]
- The orchestrator coordinates modules through `InitSystem`, `DispatchTick`, and `ScheduleTask`, so configuration must be ready before engines subscribe. [Source: architecture-fullstack/components.md#orchestrator-core]

### Component Specifications
- Configuration Loader parses ASCII-only values, validates lists, and returns DTOs consumed throughout the EA. [Source: architecture-fullstack/components.md#configuration-loader]
- Symbol engines rely on configuration DTOs to execute trade lifecycle per symbol and report runtime state. [Source: architecture-fullstack/components.md#symbol-engine]
- Dashboard renderer consumes symbol runtime state and configuration-provided styles to render readiness and status. [Source: architecture-fullstack/components.md#dashboard-renderer]
- Symbol state and configuration are shared via the in-memory `SymbolStateRegistry` ensuring modules access consistent snapshots. [Source: architecture-fullstack/tech-stack.md#tech-stack]

### File Locations
- Configuration parsing utilities live in `Include/fairPriceMP/ConfigLoader.mqh`; DTO definitions sit under `Include/fairPriceMP/DTO`. [Source: architecture-fullstack/backend-architecture.md#service-architecture]
- Orchestrator bootstrap logic resides in `src/MT5/Experts/fairPriceMP/CoreOrchestrator.mq5`. [Source: architecture-fullstack/backend-architecture.md#service-architecture]
- Runtime registries and modules sit beneath `src/MT5/Experts/fairPriceMP/Modules/` aligning with the unified project structure. [Source: architecture-fullstack/unified-project-structure.md#unified-project-structure]

### Testing Requirements
- Backend unit tests must exercise config parsing, symbol validation, and DTO propagation per the backend unit testing guidance. [Source: architecture-fullstack/testing-strategy.md#backend-tests]
- Strategy tester multi-symbol runs with log diff scripts validate readiness announcements and configuration-driven behaviour. [Source: architecture-fullstack/testing-strategy.md#e2e-tests]
- Persistence round-trip checks should confirm snapshots reflect seeded configuration data. [Source: architecture-fullstack/testing-strategy.md#backend-tests]

### Technical Constraints
- Enforce ASCII-only strings and wrap MT5 API calls using provided facades when interacting with configuration data. [Source: architecture-fullstack/coding-standards.md#coding-standards]
- MT5 build must be >= 3900 and execution remains single-process; configuration and state stay in-process per design. [Source: architecture-fullstack/tech-stack.md#tech-stack]
- Input validation must reject unsupported symbols or invalid numeric ranges before engines start, logging via structured logger. [Source: architecture-fullstack/security-and-performance.md#security-and-performance]
- All modules operate inside event-driven orchestration to support up to 28 symbols without tight coupling. [Source: architecture-fullstack/high-level-architecture.md#high-level-architecture]

### Testing
- Backend unit tests: Config loader duplicate detection, DTO propagation into `SymbolStateRegistry`. [Source: architecture-fullstack/testing-strategy.md#backend-tests]
- E2E: Multi-symbol strategy tester run verifying readiness logs and snapshot exports. [Source: architecture-fullstack/testing-strategy.md#e2e-tests]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-02-10 | 0.1 | Initial draft created. | Bob |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
